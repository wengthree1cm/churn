<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Churn Predictor</title>
  <style>
    body { font-family: Arial; margin: 2em; }
    label, select, input, button { margin: 0.5em 0; display: block; }
    table { border-collapse: collapse; margin-top: 1em; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
  </style>
</head>
<body>
  <h1>üìä Customer Churn Predictor</h1>
  <form id="predict-form">
    <label>Upload CSV File:
      <input type="file" id="csv-file" name="file" accept=".csv" required />
    </label>

    <label>Choose Model:
      <select id="model-select" name="model_type">
        <option value="xgboost">XGBoost</option>
        <option value="random_forest">Random Forest</option>
        <option value="logistic">Logistic Regression</option>
        <option value="lightgbm">LightGBM</option>
      </select>
    </label>

    <button type="submit">Predict</button>
  </form>

  <div id="output"></div>

  <script>
    const form = document.getElementById("predict-form");
    const output = document.getElementById("output");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const fileInput = document.getElementById("csv-file");
      const model = document.getElementById("model-select").value;

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);
      formData.append("model_type", model);

      output.innerHTML = "‚è≥ Loading...";

      try {
        const response = await fetch("https://churn-prediction-udq1.onrender.com/predict", {
        method: "POST",
        body: formData,
        });

        const result = await response.json();

        if (result.error) {
          output.innerHTML = `<p style="color: red;">‚ùå ${result.error}</p>`;
          return;
        }

        // Render JSON as a table
        if (Array.isArray(result) && result.length > 0) {
          const keys = Object.keys(result[0]);
          let table = "<table><thead><tr>";
          keys.forEach(k => table += `<th>${k}</th>`);
          table += "</tr></thead><tbody>";
          result.forEach(row => {
            table += "<tr>";
            keys.forEach(k => table += `<td>${row[k]}</td>`);
            table += "</tr>";
          });
          table += "</tbody></table>";
          output.innerHTML = table;
        } else {
          output.innerHTML = "<p>No data returned.</p>";
        }

      } catch (err) {
        output.innerHTML = `<p style="color:red;">‚ùå Error: ${err.message}</p>`;
      }
    });
  </script>
</body>
</html>
